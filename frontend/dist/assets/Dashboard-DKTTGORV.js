import{ah as e,ap as U,aq as H,ai as B,ao as P,a as $}from"./index-Cd0kSdaF.js";import{E as _,Q as K,V,W as X,M as C,X as x,Y as I,Z as b,T as Y,_ as v}from"./IdurarOs-Vv71th3u.js";import{u as z}from"./useDate-BcaeHTEz.js";import{u as q}from"./useFetch-BkNAQUmQ.js";import{t as Z}from"./statusTagColor-DxbKI3gy.js";import{e as A}from"./actions-BiJ_6wdU.js";import{F as G}from"./FilePdfOutlined-DEQ3xdwW.js";import{D as J,E as ee,s as M}from"./ErpApp-DLeU0-DG.js";import{F as te}from"./Table-OwE06Nju.js";import{T as R}from"./index-DZGkyCsu.js";import{P as ae}from"./progress-4ote31Tx.js";import"./index-DHqFXhNz.js";import"./DownOutlined-BTlj5zpM.js";function O({...t}){const s=_();let{entity:n,dataTableColumns:r}=t;const o=[{label:s("Show"),key:"read",icon:e.jsx(K,{})},{label:s("Edit"),key:"edit",icon:e.jsx(V,{})},{label:s("Download"),key:"download",icon:e.jsx(G,{})}],d=U(),a=H(),l=c=>{a(A.currentItem({data:c})),d(`/${n}/read/${c._id}`)},u=c=>{a(A.currentAction({actionType:"update",data:c})),d(`/${n}/update/${c._id}`)},h=c=>{window.open(`${X}${n}/${n}-${c._id}.pdf`,"_blank")};r=[...r,{title:"",key:"action",render:(c,m)=>e.jsx(J,{menu:{items:o,onClick:({key:j})=>{switch(j){case"read":l(m);break;case"edit":u(m);break;case"download":h(m);break}}},trigger:["click"],children:e.jsx(ee,{style:{cursor:"pointer",fontSize:"24px"},onClick:j=>j.preventDefault()})})}];const p=()=>C.list({entity:n}),{result:y,isLoading:S,isSuccess:L}=q(p),F=()=>L&&y?y.slice(0,5):[];return e.jsx(te,{columns:r,rowKey:c=>c._id,dataSource:L&&F(),pagination:!1,loading:S,scroll:{x:!0}})}function w({title:t,tagColor:s,data:n,prefix:r,isLoading:o=!1}){const{moneyFormatter:d}=z(),a=B(M);return e.jsx(x,{className:"gutter-row",xs:{span:24},sm:{span:12},md:{span:12},lg:{span:6},children:e.jsxs("div",{className:"whiteBox shadow",style:{color:"#595959",fontSize:13,minHeight:"106px",height:"100%"},children:[e.jsx("div",{className:"pad15 strong",style:{textAlign:"center",justifyContent:"center"},children:e.jsx("h3",{style:{color:"#22075e",fontSize:"large",margin:"5px 0",textTransform:"capitalize"},children:t})}),e.jsx(I,{style:{padding:0,margin:0}}),e.jsx("div",{className:"pad15",children:e.jsxs(b,{gutter:[0,0],justify:"space-between",wrap:!1,children:[e.jsx(x,{className:"gutter-row",flex:"85px",style:{textAlign:"left"},children:e.jsx("div",{className:"left",style:{whiteSpace:"nowrap"},children:r})}),e.jsx(I,{style:{height:"100%",padding:"10px 0",justifyContent:"center",alignItems:"center"},type:"vertical"}),e.jsx(x,{className:"gutter-row",flex:"auto",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:o?e.jsx(P,{}):e.jsx(Y,{title:n,style:{direction:"ltr"},children:e.jsx(R,{color:s,style:{margin:"0 auto",justifyContent:"center",maxWidth:"110px",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",direction:"ltr"},children:d(n?{amount:n,currency_code:a==null?void 0:a.default_currency_code}:{amount:0,currency_code:a==null?void 0:a.default_currency_code})})})})]})})]})})}const k={draft:"#595959",sent:"#1890ff",pending:"#1890ff",unpaid:"#ffa940",overdue:"#ff4d4f",partially:"#13c2c2",paid:"#95de64",declined:"#ff4d4f",accepted:"#95de64",cyan:"#13c2c2",purple:"#722ed1",expired:"#614700"},E=[{tag:"draft",value:0},{tag:"pending",value:0},{tag:"sent",value:0},{tag:"accepted",value:0},{tag:"declined",value:0},{tag:"expired",value:0}],ne=[{tag:"draft",value:0},{tag:"pending",value:0},{tag:"overdue",value:0},{tag:"paid",value:0},{tag:"unpaid",value:0},{tag:"partially",value:0}],se=({tag:t,color:s,value:n})=>{const r=_();return e.jsxs("div",{style:{color:"#595959",marginBottom:5},children:[e.jsx("div",{className:"left alignLeft capitalize",children:r(t)}),e.jsxs("div",{className:"right alignRight",children:[n," %"]}),e.jsx(ae,{percent:n,showInfo:!1,strokeColor:{"0%":s,"100%":s}})]})};function re({title:t="Preview",statistics:s=E,isLoading:n=!1,entity:r="invoice"}){const o=$.useMemo(()=>r==="invoice"?ne.map(a=>(Array.isArray(s)?s.find(u=>u.tag===a.tag):null)||a):E.map(a=>(Array.isArray(s)?s.find(u=>u.tag===a.tag):null)||a),[s,r]),d=(a,l)=>{const u=Object.values(k),h=u.indexOf(a.props.color),p=u.indexOf(l.props.color);return h-p};return e.jsx(x,{className:"gutter-row",xs:{span:24},sm:{span:24},md:{span:8},lg:{span:8},children:e.jsxs("div",{className:"pad20",children:[e.jsx("h3",{style:{color:"#22075e",fontSize:"large",marginBottom:40,marginTop:0},children:t}),n?e.jsx("div",{style:{textAlign:"center"},children:e.jsx(P,{})}):o==null?void 0:o.map((a,l)=>e.jsx(se,{tag:a.tag,color:k[a.tag],value:a==null?void 0:a.value},l)).sort(d)]})})}function oe(){const t=_(),{moneyFormatter:s}=z(),n=B(M),r=async({entity:i,currency:g})=>await C.summary({entity:i,options:{currency:g}}),{result:o,isLoading:d,onFetch:a}=v(),{result:l,isLoading:u,onFetch:h}=v(),{result:p,isLoading:y,onFetch:S}=v(),{result:L,isLoading:F,onFetch:c}=v();q(()=>C.summary({entity:"client"})),$.useEffect(()=>{const i=n.default_currency_code||null;i&&(a(r({entity:"invoice",currency:i})),h(r({entity:"quote",currency:i})),S(r({entity:"offer",currency:i})),c(r({entity:"payment",currency:i})))},[n.default_currency_code]);const m=[{title:t("number"),dataIndex:"number"},{title:t("Client"),dataIndex:["client","name"]},{title:t("Total"),dataIndex:"total",onCell:()=>({style:{textAlign:"right",whiteSpace:"nowrap",direction:"ltr"}}),render:(i,g)=>s({amount:i,currency_code:g.currency})},{title:t("Status"),dataIndex:"status",render:i=>{var g;return e.jsx(R,{color:(g=Z(i))==null?void 0:g.color,children:t(i)})}}];return[{result:o,isLoading:d,entity:"invoice",title:t("Invoices")},{result:l,isLoading:u,entity:"quote",title:t("proforma invoices")},{result:p,isLoading:y,entity:"offer",title:t("offers")}].map((i,g)=>{var D;const{result:N,entity:Q,isLoading:T,title:W}=i;return e.jsx(re,{title:W,isLoading:T,entity:Q,statistics:!T&&((D=N==null?void 0:N.performance)==null?void 0:D.map(f=>({tag:f==null?void 0:f.status,color:"blue",value:f==null?void 0:f.percentage})))},g)}),n?e.jsxs(e.Fragment,{children:[e.jsxs(b,{gutter:[32,32],children:[e.jsx(w,{title:t("Invoices"),tagColor:"cyan",prefix:t("This month"),isLoading:d,data:o==null?void 0:o.total}),e.jsx(w,{title:t("proforma invoices"),tagColor:"purple",prefix:t("This month"),isLoading:u,data:l==null?void 0:l.total}),e.jsx(w,{title:t("offers"),tagColor:"green",prefix:t("This month"),isLoading:y,data:p==null?void 0:p.total}),e.jsx(w,{title:t("Unpaid"),tagColor:"red",prefix:t("Not Paid"),isLoading:d,data:o==null?void 0:o.total_undue})]}),e.jsx("div",{className:"space30"}),e.jsx("div",{className:"space30"}),e.jsxs(b,{gutter:[32,32],children:[e.jsx(x,{className:"gutter-row w-full",sm:{span:24},lg:{span:12},children:e.jsxs("div",{className:"whiteBox shadow pad20",style:{height:"100%"},children:[e.jsx("h3",{style:{color:"#22075e",marginBottom:5,padding:"0 20px 20px"},children:t("Recent Invoices")}),e.jsx(O,{entity:"invoice",dataTableColumns:m})]})}),e.jsx(x,{className:"gutter-row w-full",sm:{span:24},lg:{span:12},children:e.jsxs("div",{className:"whiteBox shadow pad20",style:{height:"100%"},children:[e.jsx("h3",{style:{color:"#22075e",marginBottom:5,padding:"0 20px 20px"},children:t("Recent Quotes")}),e.jsx(O,{entity:"quote",dataTableColumns:m})]})})]})]}):e.jsx(e.Fragment,{})}function ve(){return e.jsx(oe,{})}export{ve as default};
